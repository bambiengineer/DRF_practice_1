(function(e){function t(t){for(var s,a,c=t[0],i=t[1],l=t[2],f=0,p=[];f<c.length;f++)a=c[f],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s]);u&&u(t);while(p.length)p.shift()();return n.push.apply(n,l||[]),r()}function r(){for(var e,t=0;t<n.length;t++){for(var r=n[t],s=!0,c=1;c<r.length;c++){var i=r[c];0!==o[i]&&(s=!1)}s&&(n.splice(t--,1),e=a(a.s=r[0]))}return e}var s={},o={index:0},n=[];function a(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=s,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(r,s,function(t){return e[t]}.bind(null,s));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/static/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],i=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=i;n.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";r("85ec")},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var s=r("2b0e"),o=r("5f5b"),n=(r("f9e3"),r("2dd8"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("router-view")],1)}),a=[],c=(r("034f"),r("2877")),i={},l=Object(c["a"])(i,n,a,!1,null,null,null),u=l.exports,f=(r("ac1f"),r("5319"),r("8c4f")),p=r("2f62"),m=(r("d3b7"),r("99af"),r("07ac"),r("bc3a")),d=r.n(m),g=d.a.create({baseURL:"/api/v1/",timeout:5e3,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});g.interceptors.request.use((function(e){M.dispatch("message/clearMessages");var t=localStorage.getItem("access");return t?(e.headers.Authorization="JWT "+t,e):e}),(function(e){return Promise.reject(e)})),g.interceptors.response.use((function(e){return e}),(function(e){console.log("error.response=",e.response);var t,r=e.response?e.response.status:500;if(400===r){var s=[].concat.apply([],Object.values(e.response.data));M.dispatch("message/setWarningMessages",{messages:s})}else if(401===r){var o=localStorage.getItem("access");t=null!=o?"ログイン有効期限切れ":"認証エラー",M.dispatch("auth/logout"),M.dispatch("message/setErrorMessage",{message:t})}else 403===r?(t="権限エラーです。",M.dispatch("message/setErrorMessage",{message:t})):(t="想定外のエラーです。",M.dispatch("message/setErrorMessage",{message:t}));return Promise.reject(e)}));var h=g;s["default"].use(p["a"]);var v,b,w,y,x,j,_={namespaced:!0,state:{username:"",isLoggedIn:!1},mutations:{ser:function(e,t){e.username=t.user.username,e.isLoggedIn=!0},clear:function(e){e.username="",e.isLoggedIn=!1}},actions:{login:function(e,t){return h.post("/auth/jwt/create/",{username:t.username,password:t.password}).then((function(t){return localStorage.setItem("access",t.date.access),e.dispatch("renew")}))},logout:function(e){localStorage.removeItem("access"),e.commit("clear")},renew:function(e){return h.get("/auth/users/me/").then((function(t){var r=t.date;e.commit("set",{user:r})}))}}},O={namespaced:!0,state:{error:"",warnings:[],info:""},mutations:{set:function(e,t){t.error&&(e.error=t.error),t.warnings&&(e.warnings=t.warnings),t.info&&(e.info=t.info)},clear:function(e){e.error="",e.warnings=[],e.info=""}},actons:{setErrorMessage:function(e,t){e.commit("clear"),e.commit("set",{error:t.message})},setWarningMessage:function(e,t){e.commit("clear"),e.commit("set",{info:t.message})},clearMessage:function(e){e.commit("clear")}}},M=(new p["a"].Store({modules:{auth:_,message:O}}),Store({state:{},mutations:{},actions:{},modules:{}})),S={},C=Object(c["a"])(S,v,b,!1,null,null,null),I=C.exports,L=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"login-page"}},[r("GlobalHeader"),r("GlobalMessage"),r("main",{staticClass:"container mt-5 p-5"},[r("p",{staticClass:"h5 mb-5"},[e._v("ログイン")]),r("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitLogin.apply(null,arguments)}}},[r("div",{staticClass:"row form-group"},[r("label",{staticClass:"col-sm-3 col-form-label"},[e._v("ユーザー名")]),r("div",{staticClass:"col-sm-8"},[r("b-input",{attrs:{type:"text",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)]),r("div",{staticClass:"row form-group"},[r("label",{staticClass:"col-sm-3 col-form-label"},[e._v("パスワード")]),r("div",{staticClass:"col-sm-8"},[r("b-input",{attrs:{type:"password",required:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)]),r("div",{staticClass:"row text-center mt-5"},[r("div",{staticClass:"col-sm-12"},[r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("ログイン")])],1)])])],1),r("div",{staticClass:"m-5"},[r("pre",[e._v("form: "+e._s(e.form))]),r("pre",[e._v("state: "+e._s(this.$store.state))])])],1)},P=[],$={},q=Object(c["a"])($,w,y,!1,null,null,null),E=q.exports,T={},k=Object(c["a"])(T,x,j,!1,null,null,null),G=k.exports,A={components:{GlobalHeader:E,GlobalMessage:G},data:function(){return{form:{username:"",password:""}}},methods:{submitLogin:function(){var e=this;this.$store.dispatch("auth/login",{username:this.form.username,password:this.form.password}).then((function(){console.log("Login succeeded."),e.$store.dispatch("message/setInfoMessage",{message:"ログインしました。"});var t=e.$route.query.next||"/";e.$router.replace(t)}))}}},W=A,H=Object(c["a"])(W,L,P,!1,null,null,null),J=H.exports;s["default"].use(f["a"]);var R=[{path:"/",component:I,meta:{requiresAuth:!0}},{path:"/login",component:J},{path:"/:catchAll(.*)",redirect:"/"}],U=new f["a"]({mode:"history",routes:R});function X(e){console.log("Force to login page."),U.replace({path:"/login",query:{next:e.fullPath}})}U.beforeEach((function(e,t,r){var s=M.state.auth.isLoggedIn,o=localStorage.getItem("access");console.log("to.path=",e.path),console.log("isLoggedIn=",s),e.matched.some((function(e){return e.meta.requiresAuth}))?s?(console.log("User is already logged in. So, free to next."),r()):(console.log("User is not logged in."),null!=o?(console.log("Try to renew user info."),M.dispatch("auth/renew").then((function(){console.log("Succeeded to renew. So, free to next."),r()})).catch((function(){X(e)}))):X(e)):(console.log("Go to public page."),r())}));var z=U;s["default"].config.productionTip=!1,s["default"].use(o["a"]),new s["default"]({router:z,store:M,render:function(e){return e(u)}}).$mount("#app")},"85ec":function(e,t,r){}});
//# sourceMappingURL=index.223f16d8.js.map